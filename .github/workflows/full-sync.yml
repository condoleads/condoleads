name: Full MLS Sync
on:
  workflow_dispatch:
    inputs:
      area:
        description: 'Area name (e.g., Toronto, York, Peel) or "all"'
        required: true
        default: 'all'
      property_type:
        description: 'Property type'
        type: choice
        options:
          - both
          - freehold
          - condo
      concurrency:
        description: 'Parallel municipalities'
        type: number
        default: 3
      force:
        description: 'Force re-sync all (ignore completed status)'
        type: boolean
        default: false

env:
  NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
  SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY }}
  PROPTX_RESO_API_URL: ${{ secrets.PROPTX_API_URL }}
  PROPTX_VOW_TOKEN: ${{ secrets.PROPTX_VOW_TOKEN }}
  PROPTX_DLA_TOKEN: ${{ secrets.PROPTX_DLA_TOKEN }}

jobs:
  sync:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - run: npm ci
      - name: Run full sync
        run: npx tsx scripts/full-sync-homes.ts --area=${{ inputs.area }} --type=${{ inputs.property_type }} --concurrency=${{ inputs.concurrency }} ${{ inputs.force == true && '--force' || '' }}

